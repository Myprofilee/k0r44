//get accessories doc from db
db.collection("/koraa/items/category/ux design/application/").onSnapshot((snapshot) => {
    fetchTrending(snapshot.docs);
});

// --------------------fetch accessories from backend --------------------
const exploreContainer = document.querySelector(".koraProduct");

const fetchTrending = (data) => {
    let html = "";
    data.forEach((doc) => {
        const product = doc.data();
        const li = `

    <div class="col">
        <div class="product-card ${product.stock}">
            <div class="product-media">
                <div class="product-label">
                    <label class="label-text new">${product.category}</label>
                </div>
                <a class="product-image" href="product-video.html">
                    <img src="${product.img}" alt="product">
                </a>
                <div class="product-widget">
                    <a title="Product View" href="#" class="ri-eye-line" style="display: ${product.displayPreview};"></a>
                </div>
            </div>
            <div class="product-content">
                <div class="product-rating">
                    <a>By : ${product.author}</a>
                </div>
                <h6 class="product-name">
                    <a href="product-video.html">${product.name}</a>
                </h6>
                <h6 class="product-price">
                    <span>${product.harga}</span>
                </h6>

                <button class="product-add" title="Add to Cart" style="display: ${product.displayBuy};">
                    <i class="fas fa-shopping-basket"></i>
                    <span>Buy Now</span>
                </button>
            </div>
        </div>
    </div>

            `;

        html += li;
    });

    exploreContainer.innerHTML = html;
};

// --------------------add to cart from frontend--------------------
function addToCart(name, price, image) {
    var user = firebase.auth().currentUser;

    if (user) {
        // User is signed in.
    } else {
        // No user is signed in.
        M.toast({ html: "Please Login or Signup" });
    }

    db.doc(`users/${user.email}`)
        .collection("usercart")
        .doc(`${name}`)
        .get()
        .then((doc) => {
            console.log(doc.exists);
            if (doc.exists) {
                M.toast({ html: "Item already added to your cart" });
            } else {
                db.doc(`users/${user.email}`)
                    .collection(`usercart`)
                    .doc(`${name}`)
                    .set({
                        useruid: user.uid,
                        name: name,
                        price: Number(price),
                        image: image,
                    })
                    .then(() => {
                        M.toast({ html: "Item added to your cart" });
                    });
            }
        });
}
